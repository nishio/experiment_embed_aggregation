# 埋め込みベクトルと凝集クラスタリングによるパブリックコメント分析実験

## 概要

本実験では、[nishio/aipubcom-data](https://github.com/nishio/aipubcom-data)リポジトリのパブリックコメントデータを使用し、SentenceTransformerによる埋め込みベクトル生成と凝集クラスタリングを実施しました。目的は、類似したコメントを特定し、パブリックコメントの重複や類似パターンを分析することです。

## 実験手法

1. **データ処理**
   - aipubcom_comments.csvから「comment」カラムを抽出
   - 重複テキストを除去して一意のコメントのみを処理
   - 結果: 6,994件の総コメントから6,966件の一意のコメントを抽出
   - 注: CSVファイルは111,514行ありますが、実際のコメント行数は6,994件です

2. **埋め込みベクトル生成**
   - モデル: `sentence-transformers/paraphrase-multilingual-mpnet-base-v2`
   - バッチサイズ: 1,000（メモリ使用量を制御）
   - 各コメントを768次元のベクトルに変換

3. **凝集クラスタリング**
   - アルゴリズム: scikit-learnのAgglomerativeClustering
   - 距離メトリック: コサイン距離
   - 距離閾値: 0.4
   - リンケージ: complete
   - 結果: 496個のクラスタを検出

## 主要な発見

### 1. 最も近いテキストペア

最も近いペアは距離0.000589で、以下の2つのテキストでした：

```
テキスト1: 好きな作家さんが生成 AI に模倣されて筆を折られたらすごく悲しくなるから嫌
生成 AI は規制、もしくは免許制にして欲しい
手描きと AI 絵の判別がつかずトラブルにならないか不安

テキスト2: 好きな作家さんが生成 AI に模倣されて筆を折られたらすごく悲しくなるから嫌
生成 AI は規制、もしくは免許制にして欲しい
手描きと AI 絵の判別がつかずトラブルにならないか心配
```

違いは「不安」と「心配」という単語のみです。

### 2. 非常に類似したテキストペアの存在

距離が0.001未満の非常に類似したテキストペアが複数存在することを確認しました：

1. **距離: 0.000000** - クラスタリング時に検出された同一テキスト
   - 30条の4に関する長文の法的議論（ID: 4357）
   - 注: 重複除去処理後もクラスタリングアルゴリズムが距離0のペアを検出しました。これは同一テキストが異なるIDで存在する可能性を示唆しています。

2. **距離: 0.000086** - ほぼ同一のテキスト
   - 生成AIの不当利用に関する懸念を列挙したテキスト（ID番号のみ異なる）

3. **距離: 0.000100** - 句読点の違いのみ
   - AI規制に関する意見（「AI 利用・技術展開」と「AI 利用、技術展開」の違い）

### 3. パブリックコメントの投稿パターン

分析結果から、以下のパターンが観察されました：
- 完全に同一のコメントの重複投稿
- 句読点や単語のわずかな違いのみの類似投稿
- 同じ内容を少し修正して再投稿したケース

## 出力ファイル

- `aipubcom_clustering/aipubcom_embedding_clustering.py`: 実装したスクリプト
- `aipubcom_clustering/closest_pair.txt`: 最も近いペアの情報
- `aipubcom_clustering/cluster_merges.csv`: クラスタ併合情報（CSV形式）
- `aipubcom_clustering/cluster_merges.md`: クラスタ併合情報（Markdown形式）
- `aipubcom_clustering/cluster_merges.txt`: クラスタ併合情報（テキスト形式、旧バージョン）

## 技術的詳細

- 使用ライブラリ: sentence-transformers, scikit-learn, numpy, pandas, scipy
- 実行環境: Python 3.12
- 処理時間: 約8分（埋め込みベクトル生成とクラスタリング）

## 今後の展望

- より詳細なクラスタ分析による意見グループの特定
- 異なる距離閾値でのクラスタリング結果の比較
- 時系列分析による投稿パターンの変化の調査

## 参考

- [kouchou-ai/experimental/embvec_reduce_public_comment/](https://github.com/nishio/kouchou-ai/tree/main/experimental/embvec_reduce_public_comment): 参考にした実装
